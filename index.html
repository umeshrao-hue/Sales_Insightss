<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insights Report Request</title>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill=%23ffffff opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            z-index: -1;
        }
        
        .form-container { 
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.1),
                0 0 0 1px rgba(255,255,255,0.2);
            width: 100%; 
            max-width: 550px;
            position: relative;
            overflow: hidden;
        }

        .form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        h2 { 
            text-align: center; 
            margin-bottom: 30px; 
            color: #2c3e50;
            font-size: 28px;
            font-weight: 600;
            position: relative;
            padding-bottom: 15px;
        }

        h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        .form-group { 
            margin-bottom: 25px;
            position: relative;
        }
        
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: #34495e;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        input, select { 
            width: 100%; 
            padding: 14px 16px; 
            border: 2px solid #e8ecef;
            border-radius: 12px; 
            font-size: 16px;
            background: #ffffff;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 
                0 0 0 3px rgba(102, 126, 234, 0.1),
                0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        input:hover, select:hover {
            border-color: #bdc3c7;
            transform: translateY(-1px);
        }

        input[type="email"] {
            background: linear-gradient(45deg, #f8f9ff, #ffffff);
        }

        input[type="date"] {
            background: linear-gradient(45deg, #fff8f0, #ffffff);
        }

        select {
            background: linear-gradient(45deg, #f0fff4, #ffffff);
            cursor: pointer;
        }

        .date-range-container {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-range-container input {
            flex: 1;
            min-width: 150px;
        }

        .date-range-separator {
            color: #7f8c8d;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        button { 
            width: 100%; 
            padding: 16px 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none; 
            border-radius: 12px; 
            font-size: 16px; 
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }
        
        button:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #5a67d8 0%, #6b4c93 100%);
        }

        button:active {
            transform: translateY(-1px);
        }
        
        button:disabled {
            background: linear-gradient(135deg, #bdc3c7, #95a5a6);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        button:disabled:hover {
            transform: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .success-message {
            display: none;
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: none;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loading-spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Form field icons */
        .form-group::before {
            content: '';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            opacity: 0.3;
            background-size: contain;
            background-repeat: no-repeat;
            pointer-events: none;
            z-index: 1;
        }

        .form-group:has(select[id="vertical"])::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23667eea' viewBox='0 0 24 24'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/%3E%3C/svg%3E");
        }

        .form-group:has(input[type="email"])::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23667eea' viewBox='0 0 24 24'%3E%3Cpath d='M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z'/%3E%3C/svg%3E");
            top: 44px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-container {
                padding: 30px 20px;
                margin: 10px;
            }
            
            h2 {
                font-size: 24px;
            }
            
            .date-range-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .date-range-separator {
                align-self: center;
            }
            
            input, select {
                padding: 12px 14px;
            }
            
            button {
                padding: 14px 18px;
                font-size: 14px;
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .form-container {
                background: #ffffff;
                border: 2px solid #000000;
            }
            
            input, select {
                border: 2px solid #000000;
            }
            
            button {
                background: #000000;
                border: 2px solid #000000;
            }
        }
    </style>
</head>
<body>
  <div class="form-container">
    <h2>Insights Report Request</h2>

    <form id="insightsForm">
      <!-- Vertical Dropdown -->
      <div class="form-group">
        <label for="vertical">Vertical</label>
        <select id="vertical" name="vertical">
          <option value="">-- Select Vertical --</option>
        </select>
      </div>

      <!-- Counselor Email Dropdown -->
      <div class="form-group">
        <label for="counselorEmail">Counselor Email</label>
        <select id="counselorEmail" name="counselorEmail">
          <option value="">-- Select Counselor Email --</option>
        </select>
      </div>

      <!-- Product Id -->
      <div class="form-group">
        <label for="ProductId">Product Id</label>
        <select id="ProductIdName" name="ProductIdName">
          <option value="">-- Select Product Id --</option>
        </select>
      </div>

      <!-- Product Type -->
      <div class="form-group">
        <label for="ProductType">Product Type</label>
        <select id="ProductTypeName" name="ProductTypeName">
          <option value="">-- Select Product Type --</option>
        </select>
      </div>

      <!-- Email (manual entry only) -->
      <div class="form-group">
        <label for="email">Email Address (Insight)</label>
        <input type="email" id="email" name="email" placeholder="Enter email manually">
      </div>

      <!-- Date Range -->
      <div class="form-group">
        <label>Date Range</label>
        <div class="date-range-container">
          <input type="date" id="startDate" name="startDate">
          <span class="date-range-separator">to</span>
          <input type="date" id="endDate" name="endDate">
        </div>
      </div>

      <button type="submit" id="submitBtn">Generate Report</button>
    </form>
  </div>

  <script>
  let records = [];

  async function loadData() {
    try {
      const response = await fetch(
        "https://n8n.srv965309.hstgr.cloud/webhook/edd2e07e-4d02-4047-890d-2a3affd0201c?ts=" + Date.now()
      );
      records = await response.json();
      console.log("Fetched records:", records);

      // Populate Vertical (Criteria)
      const verticalSelect = document.getElementById("vertical");
      verticalSelect.innerHTML = '<option value="">-- Select Vertical --</option>';
      const uniqueCriteria = [...new Set(records.map(r => (r["Vertical"] || "").trim()).filter(Boolean))];
      uniqueCriteria.forEach(criteria => {
        const opt = document.createElement("option");
        opt.value = criteria;
        opt.textContent = criteria;
        verticalSelect.appendChild(opt);
      });

      // Populate Counselor Email (changed from Counselor Name to Email ID)
      const counselorSelect = document.getElementById("counselorEmail");
      counselorSelect.innerHTML = '<option value="">-- Select Counselor Email --</option>';
      const uniqueCounselorEmails = [...new Set(records.map(r => (r["Email ID"] || "").trim()).filter(Boolean))];
      uniqueCounselorEmails.forEach(email => {
        const opt = document.createElement("option");
        opt.value = email;
        opt.textContent = email;
        counselorSelect.appendChild(opt);
      });

      // Populate Product Id
      const productIdSelect = document.getElementById("ProductIdName");
      productIdSelect.innerHTML = '<option value="">-- Select Product Id --</option>';
      const uniqueProductIds = [...new Set(records.map(r => (r["Product Id"] || "").toString().trim()).filter(Boolean))];
      uniqueProductIds.forEach(productId => {
        const opt = document.createElement("option");
        opt.value = productId;
        opt.textContent = productId;
        productIdSelect.appendChild(opt);
      });

      // Populate Product Type - FIXED VERSION
      const productTypeSelect = document.getElementById("ProductTypeName");
      productTypeSelect.innerHTML = '<option value="">-- Select Product Type --</option>';
      
      // Get unique product types, filtering out Yes/No values and empty/null values
      const uniqueProductTypes = [...new Set(
        records.map(r => {
          const productType = r["Product Type"] || "";
          return productType.toString().trim();
        })
        .filter(productType => 
          productType && // Not empty
          productType.toLowerCase() !== "yes" && // Not "Yes"
          productType.toLowerCase() !== "no" && // Not "No"
          productType !== "true" && // Not boolean true
          productType !== "false" // Not boolean false
        )
      )];
      
      console.log("Filtered Product Types found:", uniqueProductTypes);
      
      // Sort product types for better user experience
      uniqueProductTypes.sort().forEach(productType => {
        const opt = document.createElement("option");
        opt.value = productType;
        opt.textContent = productType;
        productTypeSelect.appendChild(opt);
      });

      // If no valid product types found, add "Live Classes" as default since you mentioned it
      if (uniqueProductTypes.length === 0) {
        console.log("No product types found, adding Live Classes as default");
        const opt = document.createElement("option");
        opt.value = "Live Classes";
        opt.textContent = "Live Classes";
        productTypeSelect.appendChild(opt);
      }

    } catch (err) {
      console.error("Error fetching data:", err);
      alert("Error loading data. Please refresh the page and try again.");
    }
  }

  window.addEventListener("load", loadData);

  // Form Submit Handler
  document.getElementById("insightsForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const submitBtn = document.getElementById("submitBtn");
    const originalText = submitBtn.innerHTML;
    
    // Show loading state
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span class="loading-spinner"></span>Generating Report...';

    const payload = {
      vertical: document.getElementById("vertical").value,
      counselorEmail: document.getElementById("counselorEmail").value, // Changed from counselorName to counselorEmail
      productId: document.getElementById("ProductIdName").value,
      productType: document.getElementById("ProductTypeName").value,
      email: document.getElementById("email").value,
      startDate: formatDate(document.getElementById("startDate").value),
      endDate: formatDate(document.getElementById("endDate").value),
    };

    console.log("Submitting payload:", payload);

    try {
      const response = await fetch(
        "https://n8n.srv965309.hstgr.cloud/webhook/c84b0531-7b76-4ea7-97bc-4f8539b93798",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        }
      );
      
      if (response.ok) {
        const result = await response.json();
        console.log("Form submitted successfully:", result);
        alert("Report request submitted successfully!");
        
        // Optional: Reset form after successful submission
        // document.getElementById("insightsForm").reset();
      } else {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
    } catch (err) {
      console.error("Error submitting form:", err);
      alert("Failed to submit request. Please try again.");
    } finally {
      // Hide loading state
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
    }
  });

  // Function to format YYYY-MM-DD → M/D/YYYY
  function formatDate(dateStr) {
    if (!dateStr) return "";
    const d = new Date(dateStr);
    return (d.getMonth() + 1) + "/" + d.getDate() + "/" + d.getFullYear();
  }

  </script>

</body>
</html>